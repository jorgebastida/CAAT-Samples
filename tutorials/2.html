<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Tutorial 3 - Animable elements</title>

<script type="text/javascript" src="sh/shCore.js"></script>
<script type="text/javascript" src="sh/shBrushJScript.js"></script>
<link href="sh/shCore.css" rel="stylesheet" type="text/css" />
<link href="sh/shThemeDefault.css" rel="stylesheet" type="text/css" />    

<script type="text/javascript" src="../../build/caat.js"></script>

<script type="text/javascript">
     SyntaxHighlighter.all()
</script>
    
<style>
    div.code {
       font-size: .7em;
    }
    div.APIENTRY {
        background-color: #f0f0f0;
    }
</style>

</head>


<body style="color:black; background:#ffffff;">





<div class="section">
    <p>Let's start by understanding the elements of the hierarchy and their API from top down, that's it, from the
    Director to simple Actors.</p>
</div>

<div class="section">
    <h1>CAAT.Director</h1>
    <p>The director is the root in the hierarchy of CAAT components. In its core is an ActorContainer
       which manages the timeline and switching between different Scene objects among other responsibilities.
    <p>This element will be responsible for many key features including:</p>
    <ul>
        <li>Manage the Scenes.</li>
        <li>Ellegantly switch between two given scenes.</li>
        <li>Route input events to the properly Actor.</li>
        <li>Manage the main timeline.</li>
        <li>Stablish custom timelines for each Scene.</li>
        <li>Keep reference of the associated canvas.</li>
        <li>Expose the canvas' rendering context as an internal attribute.</li>
        <li>Keep track of resources such as images and sounds.</li>
        <li>Get rid of unneeded Actors.</li>
    </ul>
    <p>Besides that, the developer has the opportunity of setting the desired animation quality in the form of frames
    per second. This parameter is to set the desired smoothness of the animation though it will automatically balance to fit
    your systems current capabilities.</p>
    <p>The lifecycle of the director will be as follows</p>
    <ol>
        <li>Create the director by specifying at least its dimension. This is performed by a call to the method
        <code>initialize(width,height,canvas)</code></li>
        <li>Add at least one scene to the director. Call the method <code>addScene(scene)</code></li>
        <li>Instrument the engine to start de animation by calling CAAT.loop. It is also possible
            to start the animation by calling <code>director.loop({number}expexted fps), but this is
            not the recommended way.</code></li>
    </ol>
    <p>Once this process is done, the director starts animation, and won't stop until the the document that contains the actors
    changes.</p>
    <p>During execution, the Director class instance exposes a lot of functionality to switch between
    two given Scenes or to change the current Scene. The following methods will do it:</p>
    <div class="APIENTRY">
        <p><b>function setScene( sceneIndex )</b></p>
        <p>Changes (or sets) the current Director scene to the index specified as parameter. There will be no transition on scene change.</p>
    </div>
    <div class="APIENTRY">
        <p><b>function switchToPrevScene(time, alpha, transition)<br>function switchToNextScene(time, alpha, transition)</b>
        <p>These methods will switch from the current scene to the previous or the next one respectively. The supplied parameters are:</p>
        <ul>
            <li>time: how much time to take for the switching process. Expressed in milliseconds.</li>
            <li>alpha: wheter alpha transparency fading should be applied to entering/exiting scenes.</li>
            <li>transition: the type of the transition to perform for the entering and exiting scenes.</li>
        </ul>
    </div>
    <div class="APIENTRY">
        <p><b>function easeInOut( inSceneIndex, typein, anchorin, outSceneIndex, typeout, anchorout, time, alpha, interpolatorIn, interpolatorOut )</b>
        <p>This method offers full control over the process of switching between any given two Scenes.</p>
        <p>To apply this method, you must specify the type of transition to apply for each Scene and
        the anchor to keep the Scene pinned at.</p>
        <p>The type of transition will be one of the following values defined in CAAT.Scene.prototype:</p>
        <ul>
            <li>EASE_ROTATION
            <li>EASE_SCALE
            <li>EASE_TRANSLATION
        </ul>
        <p>The anchor will be any of these values defined in CAAT.Actor.prototype:</p>
        <ul>
            <li>ANCHOR_CENTER
            <li>ANCHOR_TOP
            <li>ANCHOR_BOTTOM
            <li>ANCHOR_LEFT
            <li>ANCHOR_RIGHT
            <li>ANCHOR_TOP_LEFT
            <li>ANCHOR_TOP_RIGHT
            <li>ANCHOR_BOTTOM_LEFT
            <li>ANCHOR_BOTTOM_RIGHT
        </ul>
        <p>In example, for an entering scene performing a EASE_SCALE transition, the anchor is the
        point by which the scene will scaled.</p>
    </div>
    <div class="APIENTRY">
        <p><b>function easeInOutRandom(inIndex,outIndex,time,alpha)</b>
        <p>This method will switch between two given Scene indexes (ie, take away scene number 2,
        and bring in scene number 5).</p>
        <p>It will randomly choose for each Scene the type of transition to apply and the anchor
        point of each transition type.</p>
        <p>It will also set for different kind of transitions the following interpolators:
        <ul>
            <li>EASE_ROTATION    -> ExponentialInOutInterpolator, exponent 4.
            <li>EASE_SCALE       -> ElasticOutInterpolator, 1.1 and .4
            <li>EASE_TRANSLATION -> BounceOutInterpolator
        </ul>
        <p>These are the default values, and could not be changed by now.
        This method in final instance delegates the process to easeInOutMethod.
    </div>

    <p>The director also offers methods to know in what environment it is being played. Methods such us</p>
    <div class="APIENTRY">
        <p><b>getBrowserName()</b>
        <p>Gets the running browser name.</p>
    </div>
    <div class="APIENTRY">
        <p><b>getBrowserVersion()</b>
        <p>Gets the running browser version.</p>
    </div>
    <div class="APIENTRY">
        <p><b>getOSName()</b>
        <p>Gets the operating system name.</p>
    </div>

    <p>Additionally the director has a resource cache. The cache is an array of JSON objects of the form
    <code>{ id: string, image: image_object }</code>. This JSON can be generated automatically by instrumenting
    an instance of CAAT.ImagePreloader object.</p>
    <div class="APIENTRY">
        <p><b>getImage(resource_name)</b>
        <p>Gets the resource with the specified resource name. The Director hold a parameter called imagesCache where you can store a JSON of
        the form <code>[ { id: imageId, image: imageObject } ]</code>. This structure will be used as a resources cache. There's a CAAT.ImagePreloader
        class to preload resources and generate this structure on loading finalization.</p>
    </div>

    <p>Finally, there can be more than one Director on the same page, and you can gain control for any of them
       and communicate one Director instance with the others.</p>
</div>

<div class="section">
    <h1>CAAT.Scene</h1>
    <p>The Scene class is the main container of animation Actors in a Scene. It is an advanced ActorContainer
    which has two main responsibilities:
    <ol>
        <li>Knows how to remove himself elegantly from screen
        <li>Maintain a virtual timeline for all its contained Actors.
    </ol>
    <p>An Scene can not contain neither other Scenes, nor any Director. The size of the scene will be
    the same of the Director, and hence, equals to the Canvas size, that is, the values passed to
    the initialize method of the director. The canvas size may vary with the window resize listener
    thought.</p>
    <p>
        There are two ways of creating an scene:
        <ol>
            <li>Manually, by calling <code>var scene= new CAAT.Scene()</code> and then adding it to the director by calling
            <code>director.addScene(scene);</code>.</li>
            <li>The recommended way which is call <code>director.createScene()</code>.</li>
        </ol>
    </p>
    <p>The only method you should call directly on Scene instances is</p>
    <div class="APIENTRY">
        <p><b>addChild(actor)</b>
        <p>Adds a new animation Actor to the Scene. It can be any kind of ActorContainer or Actor.</p>
    </div>
    <p>All the other methods will called directly by the Director where the Scene is contained.
    Developers have the opportunity to override the method <code>activated()</code> which is called
    when the Scene instance has been brought in and is able to accept input.</p>
    <p>There's no limitation regarding the number of elements in an Scene, but for better performance,
       the developer better groups actors in containers, as if they where in layers. The performance is
       strictly on event dispatching to Scene Actors, since the event bubbling will try to check for every
       Actor in a Container (or Scene) if it is the target of a concrete event.
    </p>
    <p>
        The Actors on a Scene will keep z-order equally to the same order as they were added to the
        Scene/ActorContainer, so the last added Actor, will be behind all the other Actors.
    </p>
    <div class="chapter">
        <h2>Lifecycle</h2>
        <p>As we've said, an Scene has its own timeline. This is a virtual timeline, which is fed by
        the Director.</p>
        <p>An Scene will start feeding is timeline as soon as it starts to be brought in to the Director.</p>
        <p>An Scene will stop feeding is timeline when the Director finishes changing its current Scene. </p>
        <p>The Scene's timeline will be the reference time passed to all of its children as their current
           animation time.</p>
        <p>When an Scene is not anymore visible its timeline will be paused until the Scene will again be
        elligible to feed its timeline.</p>
    </div>
</div>

<div class="section">
    <h1>CAAT.Actor</h1>

    <div class="chapter">
        <h2>Clipping</h2>
        <p>Clipping is by default disabled on CAAT. Enabling it results in slowe performance, so it
        must be treated carefully. It can be enabled globally by issuing:</p>
        <div class="APIENTRY"><pre>CAAT.Actor.prototype.clip= true</pre></div>
        <p>or optionally, the developer can enable/disable clipping for indivual actors at will by settings
        Actor's clip attribute to true or false.</p>
        <p>Getting back to the first example, we're going to modify is slightly. This example allows
            dragging of its content and subcontent. Use shift+alt+control to modify default drag behavior.
            One of the Scene Actors will have clipping enabled. You'll see that in one instance you're
            able to drag the inner green Actor outside the Magenta one area. But after dropping it outside
            its parent area, you won't be able to gain drag'n'drop control over the inner Actor again.
        </p>
        <p>
            This is because of the way CAAT routes events to its Actors. <b>In order to send an event to an
            Actor, the Actor must be contained into its parent area. Period.</b>
        </p>
        <div class="code">
            <pre class="brush: js; auto-links: false; toolbar: false;">

                    var _director_5= new CAAT.Director().initialize(
                            600,
                            200,
                            document.getElementById('_c5') );

                    var _scene_5= _director_5.createScene().setFillStyle('#c0c0c0');

                    for(var i=0; i<2; i++ ) {

                        // rectangle shaped actors of 80x80 pixels.
                        var s = 80;

                        // containers can contain other actors or containers.
                        var _c5_container = new CAAT.ActorContainer().
                                setBounds(i*400+10, 20, s, s).
                                setRotation( Math.PI*2*Math.random() ).
                                setFillStyle('#ff3fff').
                                enableDrag().
                                setClip( i==0 );

                        // set container paint routine to draw an arrow
                        _c5_container.paint= function(director, time) {

                            var crx= director.ctx;

                            // fill actor
                            crx.fillStyle= this.fillStyle;
                            crx.fillRect(0,0,this.width,this.height );

                            // outline it.
                            crx.strokeStyle= 'black';
                            crx.strokeRect(0,0,this.width,this.height );

                            // draw a white arrow. just to point where position 0,0 is.
                            crx.strokeStyle='white';
                            crx.beginPath();
                            crx.moveTo(5,10);
                            crx.lineTo(20,10);
                            crx.lineTo(15,5);

                            crx.moveTo(20,10);
                            crx.lineTo(15,15);

                            crx.lineWidth=2;
                            crx.lineJoin='round';
                            crx.lineCap='round';

                            crx.stroke();
                        };

                        // add actor to scene.
                        _scene_5.addChild(_c5_container);

                        // create a container.
                        var _c5_container_child= new CAAT.ActorContainer().
                                setBounds(s/2,s/2,s/4,s/4).
                                setRotation( Math.PI*2*Math.random() ).
                                setFillStyle('#00ff00').
                                enableDrag();

                        // set a custom paint function for children inside containers.
                        _c5_container_child.paint= function(director,time) {
                            // call default container paint method.
                            CAAT.ActorContainer.superclass.paint.call(this,director,time);
                            var ctx= director.ctx;

                            // fill a white circle of 10x10 pixels at position 2,2
                            // just to show where 0,0 is positioned on screen.
                            ctx.fillStyle='white';
                            ctx.beginPath();
                            ctx.arc(7,7,5,0,2*Math.PI,false);
                            ctx.fill();
                        }

                        // add this container as a child of the previous created container.
                        _c5_container.addChild(_c5_container_child);
                    }

                    CAAT.loop(20);

            </pre>
        </div>
        <div>
            <canvas id="_c5"></canvas></div>
            <script>
                (function() {

                    var _director_5= new CAAT.Director().initialize(
                            600,
                            200,
                            document.getElementById('_c5') );

                    var _scene_5= _director_5.createScene().setFillStyle('#c0c0c0');

                    for(var i=0; i<2; i++ ) {

                        // rectangle shaped actors of 80x80 pixels.
                        var s = 80;

                        // containers can contain other actors or containers.
                        var _c5_container = new CAAT.ActorContainer().
                                setBounds(i*400+10, 20, s, s).
                                setRotation( Math.PI*2*Math.random() ).
                                setFillStyle('#ff3fff').
                                enableDrag().
                                setClip( i==0 );

                        // set container paint routine to draw an arrow
                        _c5_container.paint= function(director, time) {

                            var crx= director.ctx;

                            // fill actor
                            crx.fillStyle= this.fillStyle;
                            crx.fillRect(0,0,this.width,this.height );

                            // outline it.
                            crx.strokeStyle= 'black';
                            crx.strokeRect(0,0,this.width,this.height );

                            // draw a white arrow. just to point where position 0,0 is.
                            crx.strokeStyle='white';
                            crx.beginPath();
                            crx.moveTo(5,10);
                            crx.lineTo(20,10);
                            crx.lineTo(15,5);

                            crx.moveTo(20,10);
                            crx.lineTo(15,15);

                            crx.lineWidth=2;
                            crx.lineJoin='round';
                            crx.lineCap='round';

                            crx.stroke();
                        };

                        // add actor to scene.
                        _scene_5.addChild(_c5_container);

                        // create a container.
                        var _c5_container_child= new CAAT.ActorContainer().
                                setBounds(s/2,s/2,s/4,s/4).
                                setRotation( Math.PI*2*Math.random() ).
                                setFillStyle('#00ff00').
                                enableDrag();

                        // set a custom paint function for children inside containers.
                        _c5_container_child.paint= function(director,time) {
                            // call default container paint method.
                            CAAT.ActorContainer.superclass.paint.call(this,director,time);
                            var ctx= director.ctx;

                            // fill a white circle of 10x10 pixels at position 2,2
                            // just to show where 0,0 is positioned on screen.
                            ctx.fillStyle='white';
                            ctx.beginPath();
                            ctx.arc(7,7,5,0,2*Math.PI,false);
                            ctx.fill();
                        }

                        // add this container as a child of the previous created container.
                        _c5_container.addChild(_c5_container_child);
                    }

                    CAAT.loop(20);
                })();
            </script>
        </div>


</div>

<div class="section">
    <h1>CAAT.ActorContainer</h1>
    <p>
        An ActorContainer, is a holder for other Actors including other ActorContainers. Its main
        responsibility is to contain and manage other Actors.
    </p>
    <p>
        That means, it will compound every operation hierarchically for itslef and its contained Actors.
        That means, an ActorContainer will compose its transformations to all of its contained Actors,
        and that it will animate, paint and destroy its children when necessary.
    </p>
    <p>
        The most special kind of ActorContainer are the Director itself, and every Scene instance.
        That means, you can set a transformation on the Scene and it will be applied for every contained
        actor, as in the scene switching performed by the Director.
    </p>
    <p>
        All the particularities of the CAAT.Actor class, apply and are available as well in the
        ActorContainer.
    </p>
    <p>
        While treating with ActorContainers, we'll take special attention on Alpha composition.
        If isGlobalAlpha flag is set, the ActorContainers Alpha value will be set as the reference
        for all of its childres. Otherwise, the alpha value will be set only for this ActorContainer and
        won't affect any contained children.
    </p>
    <p>
        In this example, we're setting up two red containers with a .25 alpha composite. Both contain
        a green circle. The second container has globalAlpha set to true, so its Alpha value should
        propagate downwards in the Actor hierarchy afecting their alpha as well. 
    </p>
    <div class="code">
        <pre class="brush: js; auto-links: false; toolbar: false;">

                var _director_9= new CAAT.Director().initialize(
                        400,
                        200,
                        document.getElementById('_c9'));

                // create a vertical gradient to apply to text.
                var gradient= _director_9.ctx.createLinearGradient(0,0,0,_director_9.canvas.height);
                gradient.addColorStop(0,'#ffff00');
                gradient.addColorStop(0.5,'#00ffff');
                gradient.addColorStop(1,'blue');

                var _scene_9= _director_9.createScene().
                        setFillStyle(gradient);

                _director_9.addScene( _scene_9 );

                var _c9_c0= new CAAT.ActorContainer().
                        setBounds( 10,10, 180,180 ).
                        setFillStyle( 'red' ).
                        setAlpha(.25);

                var _c9_child0= new CAAT.ShapeActor().
                        setShape( CAAT.ShapeActor.prototype.SHAPE_CIRCLE ).
                        setFillStyle( 'green' ).
                        setBounds( 20, 20, 140, 140 );

                _c9_c0.addChild( _c9_child0 );

                var _c9_c1= new CAAT.ActorContainer().
                        setBounds( 210,10, 180,180 ).
                        setFillStyle( 'red' ).
                        setAlpha(.25).
                        setGlobalAlpha(true);

                var _c9_child1= new CAAT.ShapeActor().
                        setShape( CAAT.ShapeActor.prototype.SHAPE_CIRCLE ).
                        setFillStyle( 'green' ).
                        setBounds( 20, 20, 140, 140 );

                _c9_c1.addChild( _c9_child1 );

                _scene_9.addChild( _c9_c0 );
                _scene_9.addChild( _c9_c1 );

                CAAT.loop(1);

        </pre>
    </div>
    <div>
        <div><canvas id="_c9"></canvas></div>
        <script>
            (function() {

                var _director_9= new CAAT.Director().initialize(
                        400,
                        200,
                        document.getElementById('_c9'));

                // create a vertical gradient to apply to text.
                var gradient= _director_9.ctx.createLinearGradient(0,0,0,_director_9.canvas.height);
                gradient.addColorStop(0,'#ffff00');
                gradient.addColorStop(0.5,'#00ffff');
                gradient.addColorStop(1,'blue');

                var _scene_9= _director_9.createScene().
                        setFillStyle(gradient);

                _director_9.addScene( _scene_9 );

                var _c9_c0= new CAAT.ActorContainer().
                        setBounds( 10,10, 180,180 ).
                        setFillStyle( 'red' ).
                        setAlpha(.25);

                var _c9_child0= new CAAT.ShapeActor().
                        setShape( CAAT.ShapeActor.prototype.SHAPE_CIRCLE ).
                        setFillStyle( 'green' ).
                        setBounds( 20, 20, 140, 140 );

                _c9_c0.addChild( _c9_child0 );

                var _c9_c1= new CAAT.ActorContainer().
                        setBounds( 210,10, 180,180 ).
                        setFillStyle( 'red' ).
                        setAlpha(.25).
                        setGlobalAlpha(true);

                var _c9_child1= new CAAT.ShapeActor().
                        setShape( CAAT.ShapeActor.prototype.SHAPE_CIRCLE ).
                        setFillStyle( 'green' ).
                        setBounds( 20, 20, 140, 140 );

                _c9_c1.addChild( _c9_child1 );

                _scene_9.addChild( _c9_c0 );
                _scene_9.addChild( _c9_c1 );

                CAAT.loop(1);

            })();
        </script>
    </div>

<div class="chapter">
        <h2>Containers</h2>
        <p>In CAAT, every out-of-the-box is a CAAT.ActorContainer instance except the CAAT.Actor class itself.
        Despite it could seem odd adding ther Actor instance to (for instance) a circle CAAT.Shape it makes sense to do
        so when you need to link hierarchycally other actors to the shape. A good example could be when trying to do an
        elbow like relationshiop between two given actors. Look at scene8.js in the technical demo for a complete running
        example.</p>
        <div class="sample">
            <canvas id="_tut3_100"></canvas>
            <script>
                (function() {

                    function __createArm( root, angle, segments, armSegmentSizeW, armSegmentSizeH, armIndex, maxAngle ) {

                        var i;
                        var segment= root;

                        for( i=0; i<segments; i++ ) {

                            var color= CAAT.Color.prototype.interpolate(
                                    255,255,0,
                                    255,128,0,
                                    segments,
                                    i
                            );



                            var newSegment= new CAAT.ActorContainer().
                                setSize( armSegmentSizeH-4, armSegmentSizeH-4 ).
                                setFillStyle( 'rgb('+color.r+","+color.g+","+color.b+")" ).
                                setLocation( 0,-armSegmentSizeH );

                            if ( segment==root ) {
                                newSegment.setRotationAnchored(angle, armSegmentSizeW/2, armSegmentSizeH);
                                newSegment.oldAngle= angle;
                            } else {
                                newSegment.oldAngle= 0;
                                newSegment.animate= function(director,time) {
                                    this.setRotationAnchored(
                                            this.oldAngle+
                                            maxAngle*Math.sin(new Date().getTime()*.0005 + armIndex*Math.PI/segments/2
                                            ),
                                            armSegmentSizeW/2,
                                            armSegmentSizeH
                                    );
                                    return CAAT.ActorContainer.prototype.animate.call(this,director,time);

                                };
                            }

                            segment.addChild(newSegment);
                            segment= newSegment;
                        }
                    }

                var _director_9= new CAAT.Director().initialize(
                        200,
                        200,
                        document.getElementById('_tut3_100'));

                var _scene_9= _director_9.createScene();

                _director_9.addScene( _scene_9 );

                var root= new CAAT.ShapeActor().
                        setShape( CAAT.ShapeActor.prototype.SHAPE_CIRCLE ).
                        setBounds( _director_9.width/2, _director_9.height/2, 1, 1 ).
                        setFillStyle( 'yellow' ).
                        addBehavior(
                            new CAAT.RotateBehavior().
                                setFrameTime(0,20000).
                                setValues(0,2*Math.PI).
                                setCycle(true)
                        );

                var segments=10;
                var arms= 10;

                var i;
                for( i=0; i<arms; i++ ) {
                    __createArm( root, 2*Math.PI/arms * i, segments, 2, 10, i, Math.PI/segments/2 );
                }
                _scene_9.addChild(root);
                CAAT.loop(15);
                })();
            </script>
        </div>
    </div>
    <div class="chapter">
        <h2>Adding Actors to a Container.</h2>
        <p>There're two methods to add Actors to a Container.</p>
        <div class="APIENTRY">
            <p><strong>function addActor(actor)</strong></p>
            <p>This method adds an actor, but the actor is not added until the current CAAT.Director frame is processed.
            When adding actors to a container in example in response to behavior events, the frame current frame is being
            processed, and adding new Actors could lead to visual artifacts. The reason is that the newly added actors
            have not yet executed their animation stage when being drawn.</p>
        </div>
        <div class="APIENTRY">
            <p><strong>function addActorImmediately(actor)</strong></p>
            <p>In opposition to <code>addActor</code> method, this method adds immediately an actor to the rendereing
            pipeline, and could cause such visual artifacts.</p>
        </div>
        <p>It is up to the developer to choose the appropriate method that better copes with his needs.</p>
    </div>

</div>

<div class="section">
    <h1>CAAT.SpriteActor</h1>
    <p>CAAT has support for simple Sprite classes. The Sprite contains an instance of CAAT.CompoundImage
    which will be treated as an array of rows by columns subimages.</p>
    <p>We'll be using the following image for the sprite example: <img src="res/img/anim1.png">.</p>
    <p>Every SpriteActor must define the following attributes:</p>
    <ul>
        <li>animation image index. It means what subimages sequence to animate the sprite with.
		<li>sprite image. A CAAT.CompoundImage instance. This object will manage the sample image as
        an array of subimages.
		<li>change time. Every how much Scene time the Sprite should change the image from the Animation index.
        <li>transformation (optional). How to show the image. It can be mirrored horizontal and vertically.
    </ul>
    <p>A CAAT.SpriteActor does not need to set its dimension since it will derive it from the suplied
    sprite image. Alpha transparency applies as well to Sprites.</p>
    <p>Here it is an example where the four SpriteActor instances have each a different Sprite transformation.</p>
    <p>For this example we need some images that's why i'm using the CAAT.ImagePreloader helper. This
    object reads resources and stores them into a known structure. More about it on the Extras chapter.</p>
    <div class="code">
        <pre class="brush: js; auto-links: false; toolbar: false;">

                var _director_6= new CAAT.Director().initialize(
                        400,
                        150,
                        document.getElementById('_c6') );

                var _scene_6= _director_6.createScene();

                // define a resource preloader.
                new CAAT.ImagePreloader().loadImages(
                    [ {id:'fish',     url:'res/img/anim1.png'} ],   // get only this image.
                    function( counter, images ) {
                        if ( counter==images.length ) {             // when it is done loading

                            // save loaded resources on Director.
                            _director_6.imagesCache= images;

                            // CompoundImage, basically treates a single image as an Array
                            // of equals sized subimages. We want in this case, one row, 3 columns.
                            var cimage = new CAAT.SpriteImage().
                                    initialize( _director_6.getImage('fish'), 1, 3);

                            // create 4 fish positioned in a 2x2 array.
                            // set sprite transformation to show how fish is transformed..
                            for(var i=0; i<4; i++ ) {
                                var fish = new CAAT.Actor().
                                        setAnimationImageIndex( [0,1,2,1] ).
                                        setBackgroundImage(cimage.getRef()).
                                        setChangeFPS(350).
                                        setLocation(20+(i%2)*(15+cimage.singleWidth), 20+(15+cimage.singleWidth)*(i>1)).
                                        setSpriteTransformation(i);
                                _scene_6.addChild(fish);
                            }

                            // Sprite objects are Actors, and hence can contain behaviors.
                            var fish_scaling = new CAAT.Actor().
                                    setAnimationImageIndex( [0,1,2,1] ).
                                    setBackgroundImage(cimage.getRef()).
                                    setChangeFPS(500).
                                    setLocation(200,70).
                                    setAlpha(.8);

                            var rb_6= new CAAT.RotateBehavior().
                                    setAngles(0, 2*Math.PI).
                                    setFrameTime( 0, 20000 ).
                                    setCycle(true);

                            var cb_6= new CAAT.ContainerBehavior().
                                    setFrameTime(0,2000).
                                    setCycle(true);
                                var sb_6_x= new CAAT.ScaleBehavior().
                                        setValues( 2, 4, 2, 2 ).
                                        setFrameTime( 0, 1000 ).
                                        setPingPong();
                                var sb_6_y= new CAAT.ScaleBehavior().
                                        setValues( 2, 2, 2, 4 ).
                                        setFrameTime( 1000, 1000 ).
                                        setPingPong();
                            cb_6.addBehavior( sb_6_x );
                            cb_6.addBehavior( sb_6_y );

                            fish_scaling.addBehavior( rb_6 );
                            fish_scaling.addBehavior( cb_6 );

                            _scene_6.addChild(fish_scaling);
                        }
                    });

                CAAT.loop(20);

        </pre>
    </div>
        <div>
            <canvas id="_c6"></canvas></div>
            <script>
                (function() {

                    var _director_6= new CAAT.Director().initialize(
                            400,
                            150,
                            document.getElementById('_c6') );

                    var _scene_6= _director_6.createScene();

                    // define a resource preloader.
                    new CAAT.ImagePreloader().loadImages(
                        [ {id:'fish',     url:'res/img/anim1.png'} ],   // get only this image.
                        function( counter, images ) {
                            if ( counter==images.length ) {             // when it is done loading

                                // save loaded resources on Director.
                                _director_6.setImagesCache(images);
                                // CompoundImage, basically treates a single image as an Array
                                // of equals sized subimages. We want in this case, one row, 3 columns.
                                var cimage = new CAAT.SpriteImage().
                                        initialize( _director_6.getImage('fish'), 1, 3);

                                // create 4 fish positioned in a 2x2 array.
                                // set sprite transformation to show how fish is transformed..
                                for(var i=0; i<4; i++ ) {
                                    var fish = new CAAT.SpriteActor().
                                            setAnimationImageIndex( [0,1,2,1] ).
                                            setSpriteImage(
                                                new CAAT.CompoundImage().
                                                    initialize( _director_6.getImage('fish'), 1, 3)
                                            ).
                                            setChangeFPS(350).
                                            setLocation(20+(i%2)*(15+cimage.singleWidth), 20+(15+cimage.singleWidth)*(i>1)).
                                            setSpriteTransformation(i);
                                    _scene_6.addChild(fish);
                                }

                                // Sprite objects are Actors, and hence can contain behaviors.
                                var fish_scaling = new CAAT.Actor().
                                        setAnimationImageIndex( [0,1,2,1] ).
                                        setBackgroundImage(cimage.getRef()).
                                        setChangeFPS(500).
                                        setLocation(200,70).
                                        setAlpha(.8);

                                var rb_6= new CAAT.RotateBehavior().
                                        setValues(0, 2*Math.PI).
                                        setFrameTime( 0, 20000 ).
                                        setCycle(true);

                                var cb_6= new CAAT.ContainerBehavior().
                                        setFrameTime(0,2000).
                                        setCycle(true);
                                    var sb_6_x= new CAAT.ScaleBehavior().
                                            setValues( 2, 4, 2, 2 ).
                                            setFrameTime( 0, 1000 ).
                                            setPingPong();
                                    var sb_6_y= new CAAT.ScaleBehavior().
                                            setValues( 2, 2, 2, 4 ).
                                            setFrameTime( 1000, 1000 ).
                                            setPingPong();
                                cb_6.addBehavior( sb_6_x );
                                cb_6.addBehavior( sb_6_y );

                                fish_scaling.addBehavior( rb_6 );
                                fish_scaling.addBehavior( cb_6 );

                                _scene_6.addChild(fish_scaling);
                            }
                        });

                    CAAT.loop(20);

                })();
            </script>
        </div>


<div class="section">
    <h1>CAAT.TextActor</h1>
    <p>CAAT can show text by exposing the TextActor class.</p>
    <p>A text is defined, as in a Canvas rendering context, by the font, text alignment and text base line. As any
    CAAT Actor, the developer can define any valid Canvas rendering context fillStyle, like colors, gradients,
    other Canvas objects, or a Video object in example, and any valid stroke style</p>
    <p><b>In CAAT, neither textAlign nor textBaseline should be used.</b></p>
    <p>A TextActor can be modified by the following methods:</p>
    <div class="APIENTRY">
        <p><b>function setOutline( boolean )</b></p>
        <p>Makes the text to be outlined or not.</p>
    </div>
    <div class="APIENTRY">
        <p><b>function setOutlineColor( color )</b></p>
        <p>Sets outline color.</p>
    </div>
    <div class="APIENTRY">
        <p><b>function setFill( boolean )</b></p>
        <p>Makes the text to be filled or not.</p>
    </div>
    <div class="APIENTRY">
        <p><b>function setPath( path, interpolator, time )</b></p>
        <p>Makes the text to travel around a path.</p>
        <p>Interpolator can be undefined, leading to a default LinearInterpolator.</p>
        <p>Time can be undefined, leading to a default ten seconds to traverse.</p>
    </div>


    <p>As any other actor, a TextActor will be modified by behaviors.</p>
    <div class="code">
        <pre class="brush: js; auto-links: false; toolbar: false;">
                var _director_7= new CAAT.Director().initialize(
                        700,
                        200,
                        document.getElementById('_c7')
                        );

                var _scene_7= _director_7.createScene();

                // create a vertical gradient to apply to text.
                var gradient_top= _director_7.ctx.createLinearGradient(0,0,0,40);
                gradient_top.addColorStop(0,'#ffff00');
                gradient_top.addColorStop(0.5,'#00ffff');
                gradient_top.addColorStop(1,'blue');

                // outline text. no fillStyle since the text will just be outlined.
                var _text_00= new CAAT.TextActor().
                        setFont("40px sans-serif").
                        setText("CAAT").
                        setBaseline("top").
                        setFill(false).
                        setLocation( 0, 30 ).
                        calcTextSize(_director_7).
                        cacheAsBitmap();

                // gradient text.
                var _text_01= new CAAT.TextActor().
                        setFont("40px sans-serif").
                        setText("CAAT").
                        setFillStyle(gradient_top).
                        setBaseline("top").
                        setLocation( 0, 80 ).
                        calcTextSize(_director_7).
                        cacheAsBitmap();

                // gradient + outlined.
                var _text_02= new CAAT.TextActor().
                        setFont("40px sans-serif").
                        setText("CAAT").
                        setFillStyle(gradient_top).
                        setBaseline("top").
                        setOutline(true).
                        setOutlineColor('blue').
                        setLocation( 0, 130 ).
                        calcTextSize(_director_7).
                        cacheAsBitmap();

                _scene_7.addChild(_text_00);
                _scene_7.addChild(_text_01);
                _scene_7.addChild(_text_02);

                // a simple TextActor
                var _text_10= new CAAT.TextActor().
                        setFont("40px sans-serif").
                        setText("CAAT").
                        setFillStyle(gradient_top).
                        setBaseline("top").
                        setOutline(true).
                        setOutlineColor('yellow').
                        setLocation( 200,80 ).
                        calcTextSize(_director_7).
                        cacheAsBitmap();

                // rotate in 3 seconds
                var _text_00_rb= new CAAT.RotateBehavior().
                        setAngles(0, 2*Math.PI).
                        setFrameTime( 0, 3000 ).
                        setCycle(true);

                // scale in 6 seconds doing pingpong
                var _text_00_sb= new CAAT.ScaleBehavior().
                        setValues( .5, 2, .5, 2 ).
                        setFrameTime( 0, 6000 ).
                        setCycle(true).
                        setPingPong();

                _text_10.addBehavior( _text_00_rb );
                _text_10.addBehavior( _text_00_sb );
                _scene_7.addChild( _text_10 );


                // create a circular path.
                var _path_c7= new CAAT.Path().
                    beginPath(425,100).
                    addCubicTo( 425,0,   625,0,   625,100 ).
                    addCubicTo( 625,200,  425,200,  425,100 ).
                    endPath();

                // set an actor to be able to handle path.
                var _pathactor_c7= new CAAT.PathActor().
                        setBounds(0,0,_director_7.width,_director_7.height).
                        setPath(_path_c7);
                _scene_7.addChild( _pathactor_c7 );

                // make text traverse over the path
                var _text_20= new CAAT.TextActor().
                        setFont("30px sans-serif").
                        setText("CAAT").
                        setFillStyle('green').
                        setBaseline("bottom").      // over the path
                        setOutline(true).
                        setOutlineColor('red').
                        calcTextSize(_director_7).
                        setPath(_path_c7);          // traverse the path with defaults.
                _scene_7.addChild( _text_20 );

                // make text traverse under the path
                var _text_21= new CAAT.TextActor().
                        setFont("40px sans-serif").
                        setText("CAAT").
                        setFillStyle(gradient_top).
                        setBaseline("top").         // under path
                        setOutline(true).
                        setOutlineColor('red').
                        calcTextSize(_director_7).
                        setPath( _path_c7,
                                 new CAAT.Interpolator().createBounceInOutInterpolator(1.1, .4),
                                 20000 );
                _scene_7.addChild( _text_21 );

                CAAT.loop(20);
        </pre>
    </div>
    <div>
        <canvas id="_c7"></canvas></div>
        <script>
            (function() {

                var _director_7= new CAAT.Director().initialize(
                        700,
                        200,
                        document.getElementById('_c7')
                        );

                var _scene_7= _director_7.createScene();

                // create a vertical gradient to apply to text.
                var gradient_top= _director_7.ctx.createLinearGradient(0,0,0,40);
                gradient_top.addColorStop(0,'#ffff00');
                gradient_top.addColorStop(0.5,'#00ffff');
                gradient_top.addColorStop(1,'blue');

                // outline text. no fillStyle since the text will just be outlined.
                var _text_00= new CAAT.TextActor().
                        setFont("40px sans-serif").
                        setText("CAAT").
                        setBaseline("top").
                        setFill(false).
                        setLocation( 0, 30 ).
                        calcTextSize(_director_7).
                        cacheAsBitmap();

                // gradient text.
                var _text_01= new CAAT.TextActor().
                        setFont("40px sans-serif").
                        setText("CAAT").
                        setFillStyle(gradient_top).
                        setBaseline("top").
                        setLocation( 0, 80 ).
                        calcTextSize(_director_7).
                        cacheAsBitmap();

                // gradient + outlined.
                var _text_02= new CAAT.TextActor().
                        setFont("40px sans-serif").
                        setText("CAAT").
                        setFillStyle(gradient_top).
                        setBaseline("top").
                        setOutline(true).
                        setOutlineColor('blue').
                        setLocation( 0, 130 ).
                        calcTextSize(_director_7).
                        cacheAsBitmap();

                _scene_7.addChild(_text_00);
                _scene_7.addChild(_text_01);
                _scene_7.addChild(_text_02);

                // a simple TextActor
                var _text_10= new CAAT.TextActor().
                        setFont("40px sans-serif").
                        setText("CAAT").
                        setFillStyle(gradient_top).
                        setBaseline("top").
                        setOutline(true).
                        setOutlineColor('yellow').
                        setLocation( 200,80 ).
                        calcTextSize(_director_7).
                        cacheAsBitmap();

                // rotate in 3 seconds
                var _text_00_rb= new CAAT.RotateBehavior().
                        setAngles(0, 2*Math.PI).
                        setFrameTime( 0, 3000 ).
                        setCycle(true);

                // scale in 6 seconds doing pingpong
                var _text_00_sb= new CAAT.ScaleBehavior().
                        setValues( .5, 2, .5, 2 ).
                        setFrameTime( 0, 6000 ).
                        setCycle(true).
                        setPingPong();

                _text_10.addBehavior( _text_00_rb );
                _text_10.addBehavior( _text_00_sb );
                _scene_7.addChild( _text_10 );


                // create a circular path.
                var _path_c7= new CAAT.Path().
                    beginPath(425,100).
                    addCubicTo( 425,0,   625,0,   625,100 ).
                    addCubicTo( 625,200,  425,200,  425,100 ).
                    endPath();

                // set an actor to be able to handle path.
                var _pathactor_c7= new CAAT.PathActor().
                        setBounds(0,0,_director_7.width,_director_7.height).
                        setPath(_path_c7);
                _scene_7.addChild( _pathactor_c7 );

                // make text traverse over the path
                var _text_20= new CAAT.TextActor().
                        setFont("30px sans-serif").
                        setText("CAAT").
                        setFillStyle('green').
                        setBaseline("bottom").      // over the path
                        setOutline(true).
                        setOutlineColor('red').
                        calcTextSize(_director_7).
                        setPath(_path_c7);          // traverse the path with defaults.
                _scene_7.addChild( _text_20 );

                // make text traverse under the path
                var _text_21= new CAAT.TextActor().
                        setFont("40px sans-serif").
                        setText("CAAT").
                        setFillStyle(gradient_top).
                        setBaseline("top").         // under path
                        setOutline(true).
                        setOutlineColor('red').
                        calcTextSize(_director_7).
                        setPath( _path_c7,
                                 new CAAT.Interpolator().createBounceInOutInterpolator(1.1, .4),
                                 20000 );
                _scene_7.addChild( _text_21 );

                CAAT.loop(20);
            })();
        </script>
    </div>



<div class="section">
    <h1>CAAT.ShapeActor</h1>
    <p>
        CAAT also allows for simple shapes to be drawn as Scene Actors. The class ShapeActor will do.
        By now, only two shapes are supported but more will be added soon. These shapes are: Rectangle and
        Circle.
    </p>
    <div class="APIENTRY">
        <p><b>function setShape( shape_id )</b></p>
        <p>Sets the Shape the actor will show. Currently only SHAPE_RECTANGLE and SHAPE_CIRCLE are available.</p>
    </div>
    <div class="APIENTRY">
        <p><b>function setCompositeOp( compositeOp )</b></p>
        <p>Sets the composite operation to apply when drawing the Shape. It must be any valid canvas rendering
            context compositeOp value.</p>
    </div>
    <div>
        <p>
            An now, for a more advanced example than just draw shapes on screen.
        </p>
        <p>
            Move the mouse over the black area to see some red Circle-Shaped actors. Hold control to
            add some blue Rectangle-Shaped actors. Upon behavior expiration (ie, elements en moving and
            fading), the correspondent Actor is marked as expired and discardable, so it will be removed
            from Scene.
        </p>
    </div>
    <div class="code">
        <pre class="brush: js; auto-links: false; toolbar: false;">

                var _director_8= new CAAT.Director().initialize(
                        400,
                        200,
                        document.getElementById('_c8'));

                var _scene_8= _director_8.createScene();

                // create a container, equals in size to the director.
                var root= new CAAT.ActorContainer().
                    create().
                    setBounds(0,0,
                         _director_8.width,_director_8.height).
                    setFillStyle('#000000');

                _scene_8.addChild( root );

                // on mouse move over the root Actor
                root.mouseMove= function(mouseEvent) {

                    var r= 1+10*Math.random();

                    var bubble;

                    // is pressing control, add a Rectangle-Shaped blue Actor
                    if ( mouseEvent.isControlDown() ) {
                        bubble= new CAAT.ShapeActor().
                            setLocation( mouseEvent.point.x, mouseEvent.point.y ).
                            setSize( 5+r, 5+r ).
                            setShape( CAAT.ShapeActor.prototype.SHAPE_RECTANGLE ).
                            enableEvents(false).
                            setCompositeOp('lighter').
                            setFillStyle('blue');

                    } else {
                    // else, add a Circle-Shaped red Actor
                        bubble= new CAAT.ShapeActor().
                            setLocation( mouseEvent.point.x, mouseEvent.point.y ).
                            setSize( 5+r, 5+r ).
                            enableEvents(false).
                            setCompositeOp('lighter').
                            setFillStyle('red');
                    }

                    root.addChild(bubble);

                    // Add a container behavior, to hold a fading behavior and a moving
                    // behavior.
                    var cb= new CAAT.ContainerBehavior().
                        setFrameTime( _scene_8.time+2000+1000*Math.random(), 500 ).
                        addListener(
                            // when the container behavior is expired, expire and discard
                            // the actor.
                            {
                                behaviorExpired : function(behaviour, time, actor) {
                                    actor.
                                        setDiscardable(true).
                                        setExpired(true);
                                }
                            });

                    var ab= new CAAT.AlphaBehavior().
                        setFrameTime( 0, 500 ).
                        setValues( 1, 0 );

                    cb.addBehavior(ab);

                    var tb= new CAAT.PathBehavior().
                        setFrameTime( 0, 500 ).
                        setPath(
                            new CAAT.Path().setLinear(
                                    bubble.x, bubble.y,
                                    bubble.x, bubble.y-100-100*Math.random() ) );
                    cb.addBehavior(tb);

                    bubble.addBehavior( cb );
                }

                var span= document.getElementById('_c8_data');

                // hook on endAnimate to show on document how many Actors are alive.
                _scene_8.endAnimate= function _endAnimate(director,time) {
                    // chain to previous method. DON'T FORGET TO DO THIS!!!.
                    CAAT.Scene.superclass.endAnimate.call(this,director,time);
                    if (span!=null) {
                        span.innerText= 'Actors: '+root.childrenList.length;
                    }
                }

                CAAT.loop(20);

        </pre>
    </div>
    <div>
        <canvas id="_c8"></canvas></div>
        <div><span id="_c8_data"></span></div>
        <script>
            (function() {

                var _director_8= new CAAT.Director().initialize(
                        400,
                        200,
                        document.getElementById('_c8'));

                var _scene_8= _director_8.createScene();

                // create a container, equals in size to the director.
                var root= new CAAT.ActorContainer().
                    create().
                    setBounds(0,0,
                         _director_8.canvas.width,_director_8.canvas.height).
                    setFillStyle('#000000');
                root.mouseEnter= function(mouseEvent) {};
                root.mouseExit= function(mouseEvent) {};

                _scene_8.addChild( root );

                // on mouse move over the root Actor
                root.mouseMove= function(mouseEvent) {

                    var r= 1+10*Math.random();

                    var bubble;

                    // is pressing control, add a Rectangle-Shaped blue Actor
                    if ( mouseEvent.isControlDown() ) {
                        bubble= new CAAT.ShapeActor().
                            create().
                            setLocation( mouseEvent.point.x, mouseEvent.point.y ).
                            setSize( 5+r, 5+r ).
                            setShape( CAAT.ShapeActor.prototype.SHAPE_RECTANGLE ).
                            enableEvents(false).
                            setCompositeOp('lighter').
                            setFillStyle('blue');

                    } else {
                    // else, add a Circle-Shaped red Actor
                        bubble= new CAAT.ShapeActor().
                            setLocation( mouseEvent.point.x, mouseEvent.point.y ).
                            create().
                            setSize( 5+r, 5+r ).
                            enableEvents(false).
                            setCompositeOp('lighter').
                            setFillStyle('red');
                    }

                    root.addChild(bubble);

                    span.innerText= 'Actors: '+root.childrenList.length;

                    // Add a container behavior, to hold a fading behavior and a moving
                    // behavior.
                    var cb= new CAAT.ContainerBehavior().
                        setFrameTime( _scene_8.time+2000+1000*Math.random(), 500 ).
                        addListener(
                            // when the container behavior is expired, expire and discard
                            // the actor.
                            {
                                behaviorExpired : function(behaviour, time, actor) {
                                    actor.
                                        setDiscardable(true).
                                        setExpired(true);
                                }
                            });

                    var ab= new CAAT.AlphaBehavior().
                        setFrameTime( 0, 500 ).
                        setValues( 1, 0 );

                    cb.addBehavior(ab);

                    var tb= new CAAT.PathBehavior().
                        setFrameTime( 0, 500 ).
                        setPath(
                            new CAAT.Path().setLinear(
                                    bubble.x, bubble.y,
                                    bubble.x, bubble.y-100-100*Math.random() ) );
                    cb.addBehavior(tb);

                    bubble.addBehavior( cb );
                };

                var span= document.getElementById('_c8_data');

                CAAT.loop(20);
            })();
        </script>
    </div>


<div class="section">
    <h1>Defining custom actors</h1>
    <p>
        The cycle of putting an Actor on screen for every Actor in Scene's frame time is as follows:
    </p>
    <ul>
        <li>A call to the method animate(director, time). This method basically applies any Behavior registered for an
        Actor.</li>
        <li>If after applying the Behaviors an Actor is still in frame time, a call to the method paintActor(director, SceneTime)
        is performed. This method sets an appropriate global alpha, prepares Actor's transformation matrix, clips the
        canvas if set, etc.</li>
        <li>paintActor, then calls the method paint(director,time) which finally executes the painting routine.</li>
    </ul>
    <p>
        This method calls are automatically performed by the framework, starting from the Director and following every
        running Scene on it in a recursive object orientes fashion. CAAT in fact, tries to be object oriented.
        The Director object is in fact a special kind of ActorContainer, so it is the Scene object.
    </p>
    <p>
        To define a new Actor type, the developer first must extend either CAAT.Actor or CAAT.ActorContainer as needed.
        The extension mechanism is straightforward and performed like this:
    </p>
    <div class="code">
        <pre class="brush: js; auto-links: false; toolbar: false;">

                (function() {

                    // constructor
                    CAAT.NewActorType= function() {

                        // must chain to superclass constructor:
                        CAAT.newActorType.superclass.constructor.call(this);

                        // perform other initialization code here.
                        // better do it overriding create method.

                        return this;
                    };

                    // extension
                    extend( CAAT.NewActorType, CAAT.Actor, {
                        // overriden methods/attributes go here.
                    });
                })();

        </pre>
    </div>
    <p>
        has the opportunity to override the methods
    </p>
    <ul>
        <li>animate(director,time) to perform extra transformations or to avoid Behaviors at all. It is convenient to chain
        the call to the previous animate method by issuing a call to</li>
    <div class="code">
        <pre class="brush: js; auto-links: false; toolbar: false;">
            CAAT.NewActorType.superclass.method-to-override.call(
                this,
                overriden-method-parameter-list );
        </pre>
    </div>

        <li>paint(director,time) to perform custom paint.</li>
    </ul>
    <p>
        This is CAAT code to define the ShapeActor
    </p>
    <div class="code">
        <pre class="brush: js; auto-links: false; toolbar: false;">

                (function() {

                    // constructor
                    CAAT.ShapeActor = function() {

                        // chain superclass constructor
                        CAAT.ShapeActor.superclass.constructor.call(this);

                        // extra initialization code
                        this.compositeOp= 'source-over';
                        return this;
                    };

                    // extension
                    extend( CAAT.ShapeActor, CAAT.Actor, {

                        // overriden paint method
                        paint: function(director,time) {
                            var ctx= director.crc;

                            ctx.globalCompositeOperation= this.compositeOp;
                            if ( null!=this.fillStyle ) {
                                ...
                                ctx.arc(
                                        this.width/2,
                                        this.height/2,
                                        Math.min(this.width,this.height)/2,
                                        0,
                                        2*Math.PI,
                                        false );
                                ctx.fill();
                            }
                            ...
                        }
                    };
                })();

        </pre>
    </div>
</div>

</body>
</html>